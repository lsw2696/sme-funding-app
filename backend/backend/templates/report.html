{% extends "base.html" %}
{% block title %}세무·재무 진단 신청 | 중소기업자금119{% endblock %}
{% block content %}

<main class="main-container">
  <section class="form-card shadow">
    <h2>📊 세무·재무 진단 신청서</h2>
    <p class="form-desc">
      세무·재무 구조를 점검하고 절세 / 자금흐름 안정 / 부채관리 방향을 제안드립니다.
    </p>

    <form id="reportForm" class="input-form">
      <div class="form-grid">
        <div><label>회사명 / 상호</label><input type="text" name="company_name" required></div>
        <div><label>대표자 성함</label><input type="text" name="owner_name" required></div>

        <div><label>업종 / 주요 사업내용</label><input type="text" name="business_type" placeholder="예: 제조업, 도소매업 등"></div>
        <div><label>창업년도</label><input type="text" name="start_year" placeholder="예: 2020"></div>

        <div><label>연매출 구간</label>
          <select name="sales_range">
            <option>1억 이하</option>
            <option>1~3억</option>
            <option>3~10억</option>
            <option>10억 이상</option>
          </select>
        </div>

        <div><label>직원 수(대략)</label><input type="text" name="employee_count" placeholder="예: 3명"></div>

        <div><label>세무·재무 관련 고민</label>
          <textarea name="urgent_issue" placeholder="예: 부가세, 종합소득세, 재무제표 관리 등"></textarea>
        </div>

        <div><label>기존 세무사 / 회계관리 방식</label><input type="text" name="loan_status" placeholder="예: 외부세무대리, 직접신고 등"></div>

        <div><label>상담 요청 내용</label><input type="text" name="memo" placeholder="예: 절세전략 점검, 재무상태 분석 등"></div>

        <div><label>연락 방법</label>
          <select name="contact_method">
            <option>전화</option>
            <option>카카오톡</option>
          </select>
        </div>

        <div><label>연락 가능한 시간</label><input type="text" name="contact_time" placeholder="예: 평일 오전 10~12시"></div>

        <div><label>연락처</label><input type="text" name="phone" placeholder="010-0000-0000" required></div>
      </div>

      <button type="submit" class="submit-btn">신청 완료하기</button>
    </form>
  </section>
</main>

<!-- ✅ JavaScript 추가 (Netlify/Flask 백엔드와 연동) -->
<script>
  const BACKEND_URL = "https://sme-funding-backend.onrender.com";  // 백엔드 주소 확인!
  const form = document.getElementById("reportForm");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();  // 기본 제출 방지
    const fd = new FormData(form);
    const data = {};
    fd.forEach((v, k) => data[k] = v);

    try {
      const res = await fetch(`${BACKEND_URL}/api/submit/report`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
      });

      const result = await res.json();
      if (result.ok) {
        alert("✅ 신청이 접수되었습니다!");
        form.reset();
      } else {
        alert("❌ 오류가 발생했습니다. 다시 시도해주세요.");
      }
    } catch (err) {
      alert("🚫 서버와 연결할 수 없습니다.");
    }
  });
</script>

{% endblock %}
