{% extends "base.html" %}
{% block title %}세무·재무 진단 신청 | 중소기업자금119{% endblock %}
{% block content %}

<main class="main-container">
  <section class="form-card shadow">
    <h2>📊 세무·재무 진단 신청</h2>
    <p class="form-desc">
      회사의 재무건전성, 세금구조, 자금흐름을 종합 점검하여<br>
      절세·자금 개선방안을 제안드립니다.
    </p>

    <!-- ✅ 폼 시작 -->
    <form id="reportForm" class="input-form">
      <div class="form-grid">
        <div><label>회사명 / 상호</label><input type="text" name="company_name" required></div>
        <div><label>대표자 성함</label><input type="text" name="owner_name" required></div>

        <div><label>업종 / 주요 사업내용</label><input type="text" name="business_type" placeholder="예: 도소매, 제조업 등"></div>
        <div><label>창업년도</label><input type="text" name="start_year" placeholder="예: 2017"></div>

        <div><label>최근 매출 규모</label>
          <select name="sales_range">
            <option>1억 이하</option>
            <option>1~3억</option>
            <option>3~10억</option>
            <option>10억 이상</option>
          </select>
        </div>

        <div><label>직원 수(대략)</label><input type="text" name="employee_count" placeholder="예: 5명"></div>

        <div><label>현재 세무·재무상 가장 고민되는 부분</label>
          <textarea name="urgent_issue" placeholder="예: 세금부담, 부가세 납부, 장부관리 등"></textarea>
        </div>

        <div><label>현재 대출/보증 상황</label><input type="text" name="loan_status" placeholder="예: 정책자금 이용 중, 은행대출 없음 등"></div>

        <div><label>진단 받고 싶은 분야</label><input type="text" name="memo" placeholder="예: 세금, 재무구조, 절세 등"></div>

        <div><label>상담 희망 방식</label>
          <select name="contact_method">
            <option>전화</option>
            <option>카카오톡</option>
            <option>방문</option>
          </select>
        </div>

        <div><label>연락 가능한 시간</label><input type="text" name="contact_time" placeholder="예: 오전 10시~오후 4시"></div>

        <div><label>연락처</label><input type="text" name="phone" placeholder="010-0000-0000" required></div>
      </div>

      <button type="submit" class="submit-btn">무료 진단 신청하기</button>
    </form>
    <!-- ✅ 폼 끝 -->
  </section>
</main>

<!-- ✅ Netlify + Render 연결 스크립트 -->
<script>
// 🔹 Render에서 받은 실제 백엔드 주소로 변경하세요!
const BACKEND_URL = "https://sme-funding-backend.onrender.com"; 

// 폼 가져오기
const form = document.getElementById("reportForm");

// 폼이 제출될 때 실행
form.addEventListener("submit", async (e) => {
  e.preventDefault(); // 페이지 새로고침 방지

  // 입력값 수집
  const fd = new FormData(form);
  const data = {};
  fd.forEach((v, k) => data[k] = v);

  // Render Flask 서버의 /api/submit/report로 전송
  const res = await fetch(BACKEND_URL + "/api/submit/report", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  });

  const result = await res.json();

  // 결과 안내
  if (result.ok) {
    alert("세무·재무 진단 신청이 접수되었습니다!");
    form.reset(); // 입력창 초기화
  } else {
    alert("전송 중 오류가 발생했습니다. 다시 시도해주세요.");
  }
});
</script>

{% endblock %}
