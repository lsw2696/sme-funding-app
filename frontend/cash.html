{% extends "base.html" %}
{% block title %}운전자금 신청 | 중소기업자금119{% endblock %}
{% block content %}

<main class="main-container">
  <section class="form-card shadow">
    <h2>💸 운전자금 신청서</h2>
    <p class="form-desc">
      급한 운영자금(인건비, 자재비, 납품대금 등) 확보를 위해 전문가가 맞춤 상담을 드립니다.<br>
      입력하신 내용은 외부에 공개되지 않으며 1:1 맞춤 상담에만 활용됩니다.
    </p>

    <!-- ✅ 폼 시작 -->
    <!-- form에 id="cashForm"을 추가합니다 -->
    <form id="cashForm" class="input-form">
      <div class="form-grid">
        <div><label>회사명 / 상호</label><input type="text" name="company_name" required></div>
        <div><label>대표자 성함</label><input type="text" name="owner_name" required></div>

        <div><label>업종 / 주요 사업내용</label><input type="text" name="business_type" placeholder="예: 금속가공, PCB조립 등"></div>
        <div><label>창업년도</label><input type="text" name="start_year" placeholder="예: 2018"></div>

        <div><label>연매출 구간</label>
          <select name="sales_range">
            <option>1억 이하</option>
            <option>1~3억</option>
            <option>3~5억</option>
            <option>5억 이상</option>
          </select>
        </div>

        <div><label>직원 수(대략)</label><input type="text" name="employee_count" placeholder="예: 7명"></div>

        <div><label>가장 급한 자금 이슈</label>
          <textarea name="urgent_issue" placeholder="예: 인건비, 납품대금, 세금 등"></textarea>
        </div>

        <div><label>현재 대출/보증 현황</label><input type="text" name="loan_status" placeholder="예: 신용보증기금 보증 1건"></div>

        <div><label>희망 자금 용도</label><input type="text" name="memo" placeholder="예: 급여지급, 원자재 결제 등"></div>

        <div><label>연락 방법</label>
          <select name="contact_method">
            <option>전화</option>
            <option>카카오톡</option>
          </select>
        </div>

        <div><label>연락 가능한 시간</label><input type="text" name="contact_time" placeholder="예: 평일 오후 2~5시"></div>

        <div><label>연락처</label><input type="text" name="phone" placeholder="010-0000-0000" required></div>
      </div>

      <button type="submit" class="submit-btn">신청 완료하기</button>
    </form>
    <!-- ✅ 폼 끝 -->
  </section>
</main>

<!-- ✅ Netlify + Render 연결 스크립트 -->
<script>
// 🔹 Render에서 받은 실제 백엔드 주소로 변경하세요!
const BACKEND_URL = "https://sme-funding-backend.onrender.com"; 

// 폼 가져오기
const form = document.getElementById("cashForm");

// 폼이 제출되면 실행됨
form.addEventListener("submit", async (e) => {
  e.preventDefault(); // 페이지 새로고침 방지

  // 입력값들을 FormData로 수집
  const fd = new FormData(form);
  const data = {};
  fd.forEach((v, k) => data[k] = v);

  // Render Flask 서버로 전송
  const res = await fetch(BACKEND_URL + "/api/submit/cash", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  });

  const result = await res.json();

  // 결과 안내
  if (result.ok) {
    alert("운전자금 신청이 정상적으로 접수되었습니다!");
    form.reset(); // 입력창 초기화
  } else {
    alert("전송 중 문제가 발생했습니다. 다시 시도해주세요.");
  }
});
</script>

{% endblock %}
